<DIV CLASS="body" ID="body"><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<META NAME="generator" CONTENT="http://txt2tags.sf.net">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" HREF="statics/shopexdev.css">
<TITLE>ShopEx技术支持手册</TITLE>
</HEAD>
<BODY>
<H3>2.2.3. apache+mod_php</H3>
<P>
Windows下的apache运行php效能还是比微软原装的IIS效率高，也相对安全些，可以避免IIS中复杂的权限配置。
</P>
<P>
下面是安装流程
</P>
<P>
首先要配置好php
</P>
<H4>2.2.3.1. 下载PHP</H4>
<P>
php版本的最低的要求是4.3，可以在<A HREF="http://www.php.net/downloads.php">http://www.php.net/downloads.php</A>下载最新的php软件。
选择“Windwos Binaryies”分类下的PHP x.x.x.zip package即可，x.x.x根据不同的版本而变化。
将下载后的zip包解压，复制到某个目录下,比如E盘根目录，重命名为一个自己喜欢的名字 
</P>
<H4>2.2.3.2. 配置PHP</H4>
<P>
php只是一个脚本解释引擎，不需要做向系统注册表写入什么内容，只要配置正确，能让web服务器（iis或者apahce等）识别即可。
假设我们第一步php解压放置的目录
</P>
<PRE>
D:\runenv\php
</PRE>
<P>
下面是简要的配置过程
</P>
<OL>
<LI>配置环境变量PHPRC
<P></P>
目的是让IIS通过ISAPI接口装载php时能找到php的dll文件，以及php解释器能找到它的配置文件php.ini。右击“我的电脑”-“属性”-“高级”-“环境变量” 添加一个名为PHPRC，值为D:\runenv\php的环境变量
<P></P>
<IMG ALIGN="middle" SRC="img/install/windows/apache/1.jpg" BORDER="0" ALT="">
<P></P>
将PHPRC添加到系统的path中，右击“我的电脑”-“属性”-“高级”-“环境变量” 双击path环境变量名，打开path编辑框，在最末尾添加;%PHPRC%
<P></P>
<IMG ALIGN="middle" SRC="img/install/windows/apache/2.jpg" BORDER="0" ALT="">
<P></P>
<LI>设置php的配置文件php.ini，
<P></P>
将D:\runenv\php目录下的php.ini-dist重命名为php.ini就行了，php相关的功能是通过这个文件定义，包括相关的php扩展。
为了能让php引擎能正确找到这些扩展，我们用记事本打开这个文件，搜索“extension_dir”关键字。 把
<PRE>
extension_dir = ''
</PRE>
修改为
<PRE>
extension_dir = "D:\runenv\php\ext"
</PRE>
上面是说明扩展保存的目录是D:\runenv\php\ext目录下，配置是要根据实际情况修改。下面是要打开ShopEx需要的扩展，和ShopEx正常使用相关的扩展主要是MySQL和GD2，GD2是一个些图像操作C函数集合，这些C函数可供php脚本直接调用，以加快处理速度。修改为
<PRE>
extension=php_gd2.dll
extension=php_mysql.dll
</PRE>
如果想使用gmail的smtp功能来发信，还需要打开php的openssl扩展
<PRE>
extension=php_openssl.dll
</PRE>
只要把配置文件中这些行前面的注释符合";"去掉，重启web服务器就可以加载这些扩展。 
<P></P>
注：php4系列的MySQL功能是内置在php核心中的，不需要在配置文件中指定。
<P></P>
设置时区（针对php5）php5以前是直接读取服务器时间的，只要服务器时间正确，那边php脚本里的时间就正确，但是php5以后搞出了一个时区的概念。
必须在php.ini指定时区，找到date.timezone将它的值改为 修改为
<PRE>
date.timezone = PRC
</PRE>
php.5.2.x系列的mysql扩展可能无法加载，既在phpinfo中看不到mysql相关的扩展。只要把D:\runenv\php目录下的
<PRE>
libmysql.dll
</PRE>
和x:\runenv\php\ext
<PRE>
php_mysql.dll
</PRE>
拷贝到 
<PRE>
C:\windows\system32
</PRE>
目录下即可
</OL>

<H4>2.2.3.3. 安装apache</H4>
<P>
Apache的版本要求1.3以上。由于2.2版本有专门为windows平台做了一系列优化，推荐安装apache2.2系列！下载地址是
</P>
<P>
<A HREF="http://httpd.apache.org/download.cgi">http://httpd.apache.org/download.cgi</A>
</P>
<P>
一般是要选择“Win32 Binary without crypto(no mod_ssl)(MSI Installer)……”那个版本
</P>
<P>
安装时只要修改安装目录为D:\runenv\apache就行了，安装是注意80端口不要被其他的程序特别是迅雷霸占了 
</P>
<H4>2.2.3.4. 配置apache</H4>
<P>
Apache的配置文件httpd.conf，这个文件一般保存在apache安装目录的conf目录下（D:\runenv\apache\conf)。php将通过dll的方式嵌入到Apache中，php将在Apache的线程中运行，这将拥有最好的速度，php如有问题将会影响到apache。它通过两句话描述它和php引擎的关系
</P>
<PRE>
AddType application/x-httpd-php .php
</PRE>
<P>
这句话是给apache增加一个文件类型叫php，但是谁累处理新增加文件类型php呢？就通过下面一句话 
</P>
<PRE>
LoadModule php5_module "D:/runenv/php/php5apache2_2.dll"
</PRE>
<P>
让apache启动的时候载入D:\php目录下的php引擎接口php5apache2_2.dll，以便apache能调用php引擎去处理php脚本。
需要注意的是Apache只能识别linux的目录分隔符"/"，不能使用windows的目录分隔符"\"。 
只要httpd.conf中有以上两句话的描述，apache就和php引擎正确连接了，保存好httpd.conf，重启apache即可！
</P>
</DIV></BODY></HTML>