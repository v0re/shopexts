<DIV CLASS="body" ID="body"><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<META NAME="generator" CONTENT="http://txt2tags.sf.net">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" HREF="statics/shopexdev.css">
<TITLE>ShopEx技术支持手册</TITLE>
</HEAD>
<BODY>
<H3>2.1.1. MySQL</H3>
<P>
安装流程
</P>
<H4>2.1.1.1. 编译MySQL</H4>
<P>
请到<A HREF="http://dev.mysql.com/downloads/">http://dev.mysql.com/downloads/</A>下载MySQL的源码包。
</P>
<PRE>
tar zxvf mysql-xxx.tar.gz
</PRE>
<P>
将源码包解开，然后
</P>
<PRE>
cd mysql-xxx
</PRE>
<P></P>
<P>
进入源码目录执行下面的编译配置指令
</P>
<PRE>
CFLAGS="-O3 -mpentiumpro -mstack-align-double"
CXX=gcc
CXXFLAGS="-O3 -mpentiumpro -mstack-align-double -felide-constructors -fno-exceptions -fno-rtti"
</PRE>
<P>
如果不是intel的pentium处理器请跳过上面的设置，直接用下面的configure命令
</P>
<PRE>
./configure  --prefix=/srv/mysql --with-charset=utf8  --with-collation=utf8_general_ci --enable-thread-safe-client  --with-extra-charsets=gbk,latin1 --with-client-ldflags=-all-static --with-mysqld-ldflags=-all-static --enable-assembler --with-unix-socket-path=/tmp/mysql.sock --sysconfdir=/etc  --disable-shared --without-debug --without-isam --without-innodb --with-pthread
</PRE>
<P>
编译指令说明：
</P>
<OL>
<LI>--without-debug                                                        去除debug模式
<LI>--with-extra-charsets=gb2312                             添加gb2312中文字符支持
<LI>--enable-assembler                                                    使用一些字符函数的汇编版本
<LI>--without-isam                                                            去掉isam表类型支持 现在很少用了 isam表是一种依赖平台的表
<LI>--without-innodb                                                       去掉innodb表支持 innodb是一种支持事务处理的表,适合企业级应用，对于频繁select操作的web网站来说效率比较低
<LI>--with-pthread                                                            强制使用pthread库(posix线程库)
<LI>--enable-thread-safe-client                                    以线程方式编译客户端
<LI>--with-client-ldflags=-all-static                             以纯静态方式编译客户端
<LI>--with-mysqld-ldflags=-all-static                         以纯静态方式编译服务端 
</OL>

<P>
MySQL5.1的存储引擎做成了插件形式，MySQL5.1版本要用下面的编译指令
</P>
<PRE>
./configure  --prefix=/srv/mysql --with-charset=utf8  --with-collation=utf8_general_ci --enable-thread-safe-client  --with-extra-charsets=gbk,latin1 --with-client-ldflags=-all-static --with-mysqld-ldflags=-all-static --enable-assembler --with-unix-socket-path=/tmp/mysql.sock --sysconfdir=/etc  --disable-shared --without-debug --without-isam --without-innodb --with-pthread
</PRE>
<P>
编译安装
</P>
<PRE>
make
make install
</PRE>
<P>
MySQL的编译时间会比较长，如果一切顺利，那么编译、安装完毕后就要设置MySQL的启动脚本，在刚才的源码目录执行下面的命令
</P>
<PRE>
cp support-files/mysql.server /etc/rc.d/init.d/mysqld
chmod 0700 /etc/rc.d/init.d/mysqld
chkconfig --add mysqld
chkconfig --level 345 mysqld on
</PRE>
<P></P>
<P>
现在还不能启动MySQL，因为我们还没有初始化MySQL，生存mysql库。
</P>
<H4>2.1.1.2. 配置MySQL</H4>
<OL>
<LI>添加MySQL的运行用户和组
<PRE>
groupadd mysql
useradd  mysql -g mysql  -s /bin/false
</PRE>
<LI>初始化MySQL数据库
<PRE>
mkdir /opt/mysqldb
pushd /srv/mysql
bin/mysql_install_db --user=mysql --datadir=/opt/mysqldb
popd
cp support-files/my-medium.cnf /etc/my.cnf
</PRE>
我们显式的将MySQL数据保存目录设置到/opt/mysqldb目录下，出于磁盘I/O性能的考虑，这个/opt也最好是单独的分区！
<P></P>
<LI>修改相关目录权限，好让MySQL能正确读写
<PRE>
cd /srv
chmod 0750 mysql -R
chgrp mysql mysql -R
chown mysql /opt/mysqldb -R
</PRE>
<LI>修改/etc/rc.d/init.d/mysqld中的
<PRE>
basedir=/srv/mysql
datadir=/opt/mysqldb
</PRE>
<P></P>
配置完毕后尝试启动一下MySQL
<PRE>
service mysqld start
</PRE>
一切顺利的话应该可以看到MySQL成功启动的信息。
</OL>

<H4>2.1.1.3. 常见问题</H4>
<PRE>
/usr/bin/ld: cannot find -lgcc_s
</PRE>
<P>
首先检查gcc_s库是否存在
</P>
<PRE>
root [ /data/htdocs/lnmpp/work/mysql ]# whereis libgcc_s.so
libgcc_s: /usr/lib/libgcc_s.so
root [ /data/htdocs/lnmpp/work/mysql ]# 
</PRE>
<P>
库是存在的，并且是在标准目录中
</P>
</DIV></BODY></HTML>