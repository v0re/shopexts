<script>
  /*商品详细通用函数*/
  
   var priceControl={
              base:<{$goods.price}>,
              _format:<{$money_format|default:'false'}>,
              format:function(num){
                var part;
                if(!num)return;
                var num = num.toFloat();
                    num = num.round(this._format.decimals)+'';
                    var p =num.indexOf('.');
                    if(p<0){
                        p = num.length;
                        part = '';
                    }else{
                        part = num.substr(p+1);
                    }
                    while(part.length<this._format.decimals){
                            part+='0';
                        }
                    var c=[];
                    while(p>0){
                        if(p>2){
                            c.unshift(num.substr(p-=3,3));
                        }else{
                            c.unshift(num.substr(0,p));
                            break;
                        }
                    }
                    if(!part){
                        this._format.dec_point='';
                    }
                    return (this._format.sign||"")+c.join(this._format.thousands_sep)+this._format.dec_point+part;
            }
       };
    Number.implement({
           interzone:function(min,max){
                 var _v=this.toFloat();
                 if(!_v)_v=0;
                 return _v>=min&&_v<=max;
             }
          });
   var keyCodeFix=[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105,8,9,46,37,39];
   
   
</script>


<div class="GoodsInfoWrap">
<div id="goods-viewer">
  <table width="100%">
  <tr>
    <td valign="top"  class="goodspicbottom">
	<div style="background:#FFFFFF; width:346px; height:100%; margin:0 auto; ">
     <div class='goodspic' >
        <{require file="product/goodspics.html"}>
       </div>
	   </div>
	   <div style=" width:100%; height:5px; background:#FFFFFF; overflow:hidden;"></div>
    </td>
    <td  valign="top"  style="background:#EDECEA; ">
<!------------------------------------ 购买区域 开始 -------------------------------->
<form class="goods-action" action="<{link ctl=cart act=addGoodsToCart}>" gnotify="<{link ctl=product act=gnotify}>" method="post"<{if $goods.setting.buytarget==2}> target="_blank_cart"<{elseif $goods.setting.buytarget==3}> target="_dialog_minicart"<{/if}>>

    <h1 class="goodsname"><{$goods.name|escape:"html"}></h1>
    <{if $goods.brief}>
    <p class="brief"><{$goods.brief}></p>
    <{/if}>
    
    
    
      <ul class="goodsprops clearfix">
        <{if $goods.product_bn || $goods.products.0.bn}><li><span><{t}>Code No：<{/t}></span><span id="goodsBn"><{if $goods.product_bn}><{$goods.product_bn}><{else}><{$goods.products.0.bn}><{/if}></span></li><{/if}>
        

        

        <{if $goods.brand_name}><li><span><{t}>Brand：<{/t}></span><{if $goodsproplink}><a href="<{selector type='b' key=$goods.brand_id}>" target="_blank"><{$goods.brand_name}></a><{else}><{$goods.brand_name}><{/if}></li><{/if}>
		<{if $goods.weight && $goods.weight != 0.000 }><li><span><{t}>Standard Shipping Cost：<{/t}></span><{$goods.weight|cur}><{t}><{/t}></li><{/if}>
        
        <{if $goods.setting.score && $goods.score}><li><span><{t}>Shopping Points：<{/t}></span><span id="goodsScore"><{$goods.score}></span><{/if}>
    <{if $trading.score && $trading.score <>$goods.score}><li><{t}>特价积分：<{/t}><{$trading.score}></li><{/if}>
    <{if $goodspropposition<>2}>
    <{foreach from=$goods.prototype.ordernum item=propord key=key}>
      <{if $goods.prototype.props.$propord.show}>
      <{assign var="pkey" value=p_$propord}>
      <{assign var="pcol" value=$goods.$pkey}>
      <{if trim($pcol) !== ''}>
      <li>
      <span><{$goods.prototype.props.$propord.name}>：</span>
      <{if $goods.prototype.props.$propord.type == 'select'}>
        <{if $goodsproplink}><a href="<{selector type=$goods.type_id key=$propord value=$pcol}>" target="_blank"><{$goods.prototype.props.$propord.options[$pcol]}></a><{else}><{$goods.prototype.props.$propord.options[$pcol]}><{/if}>
      <{else}>
        <{$pcol}>
      <{/if}>
          </li>
      <{/if}>
      <{/if}>
    <{/foreach}>
    <{/if}>
     </ul>
     
     <ul class='goods-price list' style="padding:50px 0 16px 0;">
       
    <{if $goods.mktprice && $goods.setting.mktprice}>
      <li>
        <span><{t}>General Price：<{/t}></span><i class="mktprice1"><{$goods.mktprice|cur}></i>
      </li>
    <{/if}>
    
    <li>
       <span><{t}>VIP Price：<{/t}></span> 
      <span class="price1">
            <{if $goods.minprice && $goods.maxprice}>
             <{$goods.minprice|cur}>-<{$goods.maxprice|cur}>
            <{else}>
            <{$goods.price|cur}>
            <{/if}>
      </span>
      </li>
      
      <{if $goods.mktprice > $goods.price && $goods.setting.mktprice && $goods.setting.saveprice > 0}>
            <li style="display:none;"><span class="discount"><{if $goods.setting.saveprice == 1}>节省：<{$goods.mktprice-$goods.price|cur}>
              <{elseif $goods.setting.saveprice == 2}>优惠：<{$goods.price/$goods.mktprice*100|number:'2'}>%
              <{elseif $goods.setting.saveprice == 3}><{$goods.price/$goods.mktprice*10|number:'1'}>折
              <{/if}></span>
            </li>
      
      <{/if}>
      


    <{if $mLevel}>
       <li class='mprice' <{if $goods.FlatSpec || $goods.SelSpec }> style="display:none" <{/if}>>
       <span><{t}>会员价:<{/t}></span> 
        <ul>
            <{foreach from=$mLevel item=lItem name=mlv}>
            <li>
             <span><{t}><{$lItem.name}>:<{/t}></span>
             <span class='mlvprice lv-<{$lItem.member_lv_id}>' mlv='<{$lItem.member_lv_id}>'><{$goods.mprice[$lItem.member_lv_id]|cur}></span>
            </li>
            <{/foreach}>
        </ul>
      </li>
    <{/if}>


     </ul>
            
      <{if count($promotions)>0}>
      <ul class="boxBlue">
        <{foreach from=$promotions item=promotion key=key}>
          <li><{$promotion.pmt_describe}><span class="font11px fontcolorBlack"><{$promotion.pmt_time_begin|userdate}> ~ <{$promotion.pmt_time_end|userdate}></span></li>
        <{/foreach}>
    </ul>
      <{/if}>


 <div class='hightline'>
 <div class='hightbox'>
 <!---规格开始--->
<{if $goods.FlatSpec || $goods.SelSpec }>
      <div id="goods-spec" class='goods-spec'>
         <h4 class='spec-tip'><em style="color:#4A4A4A;">
         <{if $SelectSpecValue.selected}>
            Your Selection：
         <{else}>
            Please Select：
         <{/if}>
         </em>   
         <span><{$SelectSpecValue.value}></span>
         </h4>
         <input type='hidden' name='goods[product_id]' value='<{$goods.product_id}>' disabled='true'/>
         <{if $goods.FlatSpec}>
              <{foreach from=$goods.FlatSpec key=key item=goodsFlatSpecDesc}>
              <table width='100%' class='spec-item' >
                   <tr>                                                      
                    <td style=" white-space:nowrap;"><span><em><{$goodsFlatSpecDesc.name}></em>：</span></td>
                    <td style=" width:349px; height:50px;">
                      <ul>
                        <{foreach from=$goods.FlatSpec[$key].value key=skey item="subDesc"}>
                            <{if $subDesc.display=="block"}>
                            <li>
                            <a href="<{link ctl=product act=index arg0=$goods.goods_id arg1=$subDesc.spec_goods_images}>" specvid="<{$skey}>" specid="<{$key}>">
                            <{if $subDesc.spec_type=='text'}>
                                <span><nobr><{$subDesc.spec_value}></nobr></span>
                            <{else}>
                                <img src="<{$subDesc.spec_image|storager}>"  alt="<{$subDesc.spec_value}>" title="<{$subDesc.spec_value}>" width="<{$specimagewidth}>" height="<{$specimageheight}>">
                            <{/if}>
                              <i title='点击取消选择'>&nbsp;</i>
                            </a>
                            </li>
                            <{/if}>
                        <{/foreach}>
                        </ul>
                    </td>
                   </tr> 
             </table>
             <{/foreach}>
             
         <{/if}>
         <{if $goods.SelSpec}>
                <div class="spec-item" style="padding-bottom:10px;">
                <ul>
                <{foreach from=$goods.SelSpec key=selKey item=goodsSelSpecDesc}>
                  <{foreach from=$goods.SelSpec[$selKey].value key=sSelKey item="subDesc"}>
                    <{if $subDesc.selected}>
                        <{assign var='selectValue' value=$subDesc.spec_value}>
                    <{/if}>
                  <{/foreach}>
                    <li class="handle <{if $selectValue}>selected<{/if}>"><em><{$goodsSelSpecDesc.name}></em>：
                    <span><{$selectValue|default:'Please Select'}></span>
                    <{assign var="selectValue" value=''}>
                   </li>
                  <{/foreach}>
                <{foreach from=$goods.SelSpec key=selKey item=goodsSelSpecDesc}>
                   <li class="content">
                    <ul>
                    <{foreach from=$goods.SelSpec[$selKey].value key=sSelKey item="subDesc"}>
                        <{if $subDesc.display=="block"}>
                        <li>
                        <a href="<{link ctl=product act=index arg0=$goods.goods_id arg1=$subDesc.spec_goods_images}>" specvid="<{$sSelKey}>" specid="<{$selKey}>">
                        <{if $subDesc.spec_type=='text'}>
                            <span><{$subDesc.spec_value}></span>
                        <{else}>
                            <img src="<{$subDesc.spec_image|storager}>" style='border:1px #ccc solid' alt="<{$subDesc.spec_value}>" title="<{$subDesc.spec_value}>" width="<{$specimagewidth}>" height="<{$specimageheight}>">
                        <{/if}>
                        <i title='点击取消选择'>&nbsp;</i>
                        </a>
                        </li>
                        <{/if}>
                    <{/foreach}>
                  </ul>
                  </li> 
                 
                  <{/foreach}>
               </ul>
              </div>
         <{/if}>
      </div>
 <{/if}>
<!---规格结束--->

<!--购买数量-->
         <div class='buyinfo'>
         <table width='auto'>
            <tr>
               <td><span>Quantity：</span></td>
               <td> <div class="Numinput">
                    <input type="text" name="goods[num]" size="5" value=1 />
                    <span  class="numadjust increase"></span>
                    <span  class="numadjust decrease"></span>
                    </div>
               </td>
               <td> <span <{if !$showStorage}>style='display:none;'<{/if}>>&nbsp;&nbsp;(库存<span class='store'><{if $goods.store >= 9999 || $goods.store == null || $goods.store === ''}>9999+<{else}><{$goods.store}><{/if}></span>)</span></td>
            </tr>
         </table>
         </div> 
<!--购买数量结束-->
    </div><!-- end hightbox-->
  </div><!-- end hightline-->


<!------------------------------------ 配件 开始 -------------------------------->

<{if $goods.adjunct && count($goods.adjunct)>0}>
<div id='goods-adjunct' class='userselect'>
    <{foreach from=$goods.adjunct item=adj key="adj_key"}>
    <div class="choose">
    <div class="adjtitle"><{$adj.name}><em><{if $adj.min_num || $adj.max_num}><{t}>可选 <{/t}><{if $adj.min_num == $adj.max_num}><{$adj.min_num}><{else}><{$adj.min_num|default:0}>-<{$adj.max_num}><{/if}><{t}> 件<{/t}><{/if}></em><span adj="<{$adj.name}>"></span></div>
    <table width="100%" cellpadding="0" cellspacing="0">
      <tbody class="goods-adjunct-row" adjkey="<{$adj_key}>" adjname="<{$adj.name}>" min_num="<{$adj.min_num|default:0}>" max_num="<{$adj.max_num|default:-1}>" >
    <{foreach from=$adj.items item=items key="key" name=adjitems}>
      <tr price="<{$items.adjprice|cur:null:true}>" product="<{$items.goods_id}>" <{if $smarty.foreach.adjitems.last}>class="last"<{/if}>>
        <td width="5%" valign="top">
          <input type="checkbox" name='check_<{$items.product_id}>' value="<{$items.adjprice|cur:null:true}>" product="<{$items.goods_id}>"/>
        </td>
        <td width="55%">
          <p class="adjpc">
          <a<{if $items.marketable == 'true' && $items.disabled == 'false'}> href="<{link ctl="product" act="index" arg0=$items.goods_id}>" target="_blank" title="<{$items.name}>"<{/if}>>
          <{$items.name}><{if $items.pdt_desc}>[<{$items.pdt_desc}>]<{/if}></a></p>
            <{if $items.price != $items.adjprice}>
            <span class="mktprice"><{t}>原价格：<{/t}><i><{$items.price|cur}></i></span>&nbsp;&nbsp;&nbsp;&nbsp;<{/if}><span class="memberprice"><{t}>Matching Price：<{/t}><i><{$items.adjprice|cur}></i></span><span style="padding-left:10px;"><{t}>Quantity：<{/t}><input size="2" maxlength='10'  type="text" autocomplete='off' value="<{if $adj.min_num == 0}>1<{else}><{$adj.min_num|default:1}><{/if}>" name='count_check_<{$items.product_id}>' /></span>
         
        </td>
        <td></td>
        <td<{if $items.marketable == 'false' || $items.disabled == 'true'}> style="display:none"<{/if}>><a title="您可以单把独这个商品加入购物车" buy="<{$items.goods_id}>" product="<{$items.product_id}>" type="g" href="<{link ctl="cart" act="addGoodsToCart" arg0=$items.goods_id arg1=$items.product_id}>" <{if $goods.setting.buytarget==2}> target="_blank_cart"<{elseif $goods.setting.buytarget==3}> target="_dialog_minicart"<{/if}> class="addtocart" rel="nofollow"><{img src="statics/icons/btn_adj_buy.gif" alt="您可以单把独这个商品加入购物车"}></a></td>
        <td>
          <input type='hidden' name='goods[adjunct][<{$adj_key}>][<{$items.product_id}>]' value='' disabled='true'/>
        </td>
      </tr>
    <{/foreach}>
    </tbody>
    </table>
    </div>
    <{/foreach}>
    <strong>Matching Total:</strong><span class='price'></span>
  </div>
<{/if}>

<!------------------------------------ 购买 按钮 -------------------------------->

<input type="hidden" name="goods[goods_id]" value="<{$goods.goods_id}>">
<input type="hidden" name="goods[pmt_id]" value="<{$goods.pmt_id}>">

<div class="btnBar">
  <div class="floatLeft" style="width:138px;">
        <input class="actbtn btn-buy"  style="width:130px; height:30px" src="../../../../themes/zqzyb/images/goods/addtobag.gif"  value="加入购物车" type="image" >
        <input  class="actbtn btn-notify" style="width:110px;display: none; height:30px" value="缺货登记" type="submit" >
    </div>
	<div class="floatLeft"  style="width:213px; padding-top:18px; padding-left:50px;">
    <ul >
      <li <{if $login!="nologin"}>star="<{$goods.goods_id}>"<{/if}> class="star-off" title=<{$goods.name|escape:"html"}>><a <{if $login=="nologin"}> href="<{link ctl="passport" act="login"}>" <{else}>href="#" rel="nofollow" onclick="return false;" <{/if}> class="btn-fav"><{t}>Wish List<{/t}></a></li>
        <!-- <li><a href="#" class="btn-send"><{t}>发送给好友<{/t}></a></li> -->
    </ul>
	</div>
	<div style="clear:both;"></div>
</div>
</form>

<{if !$goods.adjunct }>
<div style="height:130px;"></div>
<{/if}>
    </td>
  </tr>
  
  </table>

<div style="clear:both"></div>
<!------------------------------------ 购买区域 结束 -------------------------------->
<div style="display:none">
<{if count($package)>0}>
<div class="goodspackagewrap clearfix">
<div class="active"><span><{t}>Package<{/t}></span></div>
</div>
<div class="GoodsPackageWrap">
  <{foreach from=$package item=package key=key name=packageitems}>
    <div class="items <{if $smarty.foreach.packageitems.last}>last<{/if}>">
          <div class="itemwrap">
            <table cellpadding="0" cellspacing="0">
            <tr valign="top">
      <{foreach from=$package.items item=items name=packagetd}>
            <td>
      <dl>
        <dt class="goodpic">
            <a<{if $items.marketable == 'true' && $items.disabled == 'false' && $items.goods_id != $goods.goods_id}> href="<{link ctl="product" act="index" arg0=$items.goods_id}>" target="_blank" title="<{$items.name}>"<{/if}>>
              <img src="<{$items.thumbnail_pic|gimage:'thumbnail'}>" width="55" height="55" alt="<{$items.name}>"/></a>
          </dt>
        <dd><a<{if $items.marketable == 'true' && $items.disabled == 'false' && $items.goods_id != $goods.goods_id}> href="<{link ctl="product" act="index" arg0=$items.goods_id}>" target="_blank" title="<{$items.name}>"<{/if}>><{$items.name}></a><span class="fontcolorOrange">×<{$items.pkgnum}></span><br /><{t}>价格:<{/t}><span class="fontcolorBlack fontbold"><{$items.price|cur}></span></dd>
      </dl>
            </td>
            <{if !$smarty.foreach.packagetd.last}><td class="plus">+</td><{/if}>
            <{/foreach}>
            </tr>
            </table>
          </div>
    <ul class="priceinfo">
          <li><h3><{$package.name}><span class="desc"><{$package.intro}></span></h3></li>
      <li class="mktprice1"><{t}>Sum：<{/t}><{$package.mktprice|cur}></li>
      <li class="price1"><{t}>Packaging Price：<{/t}><{$package.price|cur}></li>
            <li class="huered"><{if $package.mktprice > $package.price && $goods.setting.mktprice && $goods.setting.saveprice > 0}>
        折扣：
        <{if $goods.setting.saveprice == 1}><{$package.mktprice-$package.price|cur}>
        <{else}><{$package.price/$package.mktprice*100|number}>%<{/if}><{/if}>
            </li>
      <li><a rel="nofollow" href="<{link ctl="cart" act="addPkgToCart" arg0=$package.goods_id arg1=1}>"<{if $goods.setting.buytarget == 2}> target="_blank_cart"<{elseif $goods.setting.buytarget == 3}> target="_dialog_minicart"<{/if}>><{img class="buy" src="statics/icons/btn_pkg_buy.gif" alt="购买"}></a></li>
    </ul>
        <div class="clear"></div>
    </div>
  <{/foreach}>
</div>
<{/if}>
</div>

<div class="productcon">
<div class="goods-detail-tab clearfix">
</div>
<div class="clear"></div>
<{foreach from=$addons item=tmpl}>
  <{require file=$tmpl}>
<{/foreach}>



<{if count($package)>0}>
<div class="section pdtdetail" tab="Package" style="border:1px solid #C9C9C9; padding:10px; margin-top:5px;">
<h2><{t}>Package<{/t}></h2>
<div class="body"  id="goods-params">
<div class="itemwrap">
            <table cellpadding="0" cellspacing="0">
            <tr valign="top">
      <{foreach from=$package.items item=items name=packagetd}>
            <td align="center">
      <dl style="width:116px;">
        <dt class="goodpic" style="width:110px; text-align:center;">
            <a<{if $items.marketable == 'true' && $items.disabled == 'false' && $items.goods_id != $goods.goods_id}> href="<{link ctl="product" act="index" arg0=$items.goods_id}>" target="_blank" title="<{$items.name}>"<{/if}>>
              <img src="<{$items.thumbnail_pic|gimage:'thumbnail'}>"  alt="<{$items.name}>" style=" width:110px; height:133px;"/></a>          </dt>
        <dd><a<{if $items.marketable == 'true' && $items.disabled == 'false' && $items.goods_id != $goods.goods_id}> href="<{link ctl="product" act="index" arg0=$items.goods_id}>" target="_blank" title="<{$items.name}>"<{/if}>><{$items.name}></a><span  style="color:#FF0000;">×<{$items.pkgnum}></span><br /><{t}>Packaging Price:<{/t}><span class=" fontbold"><{$items.price|cur}></span></dd>
      </dl>
            </td>
            <{if !$smarty.foreach.packagetd.last}><td class="plus"  style=" padding-top:60px;"><img src="../../../../themes/zqzyb/images/goods/jiahao.jpg"/></td><{/if}>
            <{/foreach}>
            </tr>
            </table>
          </div>
		  <ul class="priceinfo">
          <li><h3><{$package.name}><span class="desc"><{$package.intro}></span></h3></li>
      <li class="mktprice1"><{t}>Sum：<{/t}><{$package.mktprice|cur}></li>
      <li class="price1"><{t}>Packaging Price：<{/t}><{$package.price|cur}></li>
            <li class="huered"><{if $package.mktprice > $package.price && $goods.setting.mktprice && $goods.setting.saveprice > 0}>
        折扣：
        <{if $goods.setting.saveprice == 1}><{$package.mktprice-$package.price|cur}>
        <{else}><{$package.price/$package.mktprice*100|number}>%<{/if}><{/if}>
            </li>
      <li><a rel="nofollow" href="<{link ctl="cart" act="addPkgToCart" arg0=$package.goods_id arg1=1}>"<{if $goods.setting.buytarget == 2}> target="_blank_cart"<{elseif $goods.setting.buytarget == 3}> target="_dialog_minicart"<{/if}>><img src="../../../../themes/zqzyb/images/goods/kunbang.jpg"/></a></li>
    </ul>
        <div class="clear"></div>
</div>
</div>
<{/if}>





























<{if count($goods.params)>0 && $goods.params}>  
<div class="section pdtdetail" tab="详细参数" >
<h2><{t}>详细参数<{/t}></h2>
<div class="body"  id="goods-params">
<table width="100%" cellpadding="0" cellspacing="0" class="liststyle data">
<colgroup class="span-4 ColColorGray fontcolorBlack"></colgroup>
  <{foreach from=$goods.params item=params key=group}>
  <tr><td colspan="2" class="colspan ColColorGraydark"><{$group}><span class="gname"></span></td></tr>
    <{foreach from=$params item=value key=key}>
        <{if $value != ''}>
      <tr><th><{$key}></th><td><{$value|default:'-'}></td></tr>
        <{/if}>    
        <{/foreach}>
  <{/foreach}>
  </table>
</div>
</div>
<{/if}>


<{if $goods.link_count > 0}>
<div class="section xiangguan" tab="May We Suggest">
<h2><{t}>May We Suggest<{/t}></h2>
<div class="body" id="goods-rels">
  <div class="GoodsSearchWrap">
    <table width="100%" border="0" cellpadding="0" cellspacing="6">
  <tr valign="top"> <{foreach from=$goods.link item=linklist name=goods}>
    <td class="items-gallery" product="<{$linklist.goods_id}>" >
    <div class="goodpic" align='left'>
    <a href="<{link ctl="product" act="index" arg0=$linklist.goods_id}>" style='<{if $env.thumbnail_pic_width !=0 && $env.thumbnail_pic_width !=0}> width:<{$env.thumbnail_pic_width}>px;height:<{$env.thumbnail_pic_height}>px;<{/if}>;padding:0;margin:0 auto;'>
     <img src="<{$linklist.thumbnail_pic|gimage:'thumbnail'}>"/>
     </a></div>
      <div class="goodinfo">
        <table width="100%" border="0" cellpadding="0" cellspacing="0">
           <tr>
            <td style="text-align:left; "><ul style="line-height:15px;">
			<li><a href="<{link ctl="product" act="index" arg0=$linklist.goods_id}>" title="<{$linklist.name}>"><{$linklist.name}></a></li>
                 <{if $goods.setting.mktprice}>
                <li>Market Price:<span style="text-decoration:line-through;"><{$linklist.mktprice|cur}></span></li>
                <{/if}>
				<li>VIP Price:<span style="color:#CD3F34;"><{$linklist.price|cur}></span></li>
               
              </ul></td>
            <td></td>
          </tr>
        </table>
      </div></td>
    <{if !($smarty.foreach.goods.iteration%4)}> </tr>
  <{if !$smarty.foreach.goods.last}>
  <tr valign="top"> <{/if}>
    
    <{elseif $smarty.foreach.goods.last}>
    <td colspan="<{math equation='4 - y' y=$smarty.foreach.goods.iteration%4}>">&nbsp;</td>
  </tr>
  <{/if}>
  <{/foreach}>
</table>
  </div>
</div>
</div>

<{/if}>




<{if $goods.intro}>
<div class="section pdtdetail xiangguan" tab="Description">

<div class="goodsprop_ultra clearfix">
    <{if $goodspropposition<>1}>
    <{foreach from=$goods.prototype.ordernum item=propord key=key}>
      <{if $goods.prototype.props.$propord.show}>
      <{assign var="pkey" value=p_$propord}>
      <{assign var="pcol" value=$goods.$pkey}>
      <{if trim($pcol) !== ''}>
      <div class="span-4">
      <span><{$goods.prototype.props.$propord.name}>：</span>
      <{if $goods.prototype.props.$propord.type == 'select'}>
        <{if $goodsproplink}><a href="<{selector type=$goods.type_id key=$propord value=$pcol}>" target="_blank"><{$goods.prototype.props.$propord.options[$pcol]}></a><{else}><{$goods.prototype.props.$propord.options[$pcol]}><{/if}>
      <{else}>
        <{$pcol}>
      <{/if}>
      </div>
      <{/if}>
      <{/if}>
    <{/foreach}>
    <{/if}>
</div>
<div class="body indent" id="goods-intro">
<{$goods.intro}>
</div>
</div>
<{/if}>




<{if $sellLog.display.switch  && $sellLogList.data|@count >0 && $sellLog.display.limit<= $sellLogList.data|@count }>
<div class="section pdtdetail" tab="销售记录">
<h2><{t}>销售记录<{/t}></h2>
<div class="body">
    <table border="0" cellpadding="0" cellspacing="0" width="100%" class="liststyle">
    <col class="span-5"> 
    <col class="span-3"> 
    <col > 
    <col class="span-3"> 
    <thead>
        <tr>
            <th><{t}>买家<{/t}></th>
            <th><{t}>购买价<{/t}></th>
            <th><{t}>Quantity<{/t}></th>
            <th><{t}>购买时间<{/t}></th>
        </tr>
        </thead>
        <tbody>
        <{foreach from=$sellLogList.data item=sellLogListData key=key}>
        <tr>
            <td><{$sellLogListData.name|cut:3:''}>***</td>
            <td><{$sellLogListData.price}></td> 
            <td><{$sellLogListData.number}>  <{if $sellLogListData.pdt_desc}><span class="fontcolorGray">( <{$sellLogListData.pdt_desc}> )</span><{/if}></td>
            <td><{$sellLogListData.createtime|userdate}></td>
        </tr>
        <{/foreach}>
        
        
        </tbody>
    </table>
<div class="tips"><{t}>截至今日， 累计成交<{/t}><span class="font14px fontbold fontcolorOrange"><{$sellLogList.total}></span><{t}>笔<{/t}><{if $sellLogList.total > $sellLogList.data|@count}><a href="<{link ctl=product act=selllog arg0=$goods.goods_id}>" target="_blank"><{t}>，查看更多...<{/t}></a><{/if}></div>
</div>

</div>
<{/if}>


<{if $comment.switch.discuss == 'on'}>
<div class="section pdtdetail pinglun" tab="Experience Sharing (<em><{$comment.discussCount|default:'0'}></em>)">
<h2><{$goods.name|escape:"html"}><{t}>&nbsp;&nbsp;Comments<{/t}><span><a style="color:#666666" href="<{link ctl="comment" act="commentlist" arg0=$goods.goods_id arg1="discuss"}>"><{t}>（Current Comments<{/t}><em style="color:#FF0000; padding-left:5px;"><{$comment.discussCount|default:'0'}></em><{t}>）<{/t}></a></span></h2>
<div class="FormWrap">
<{if count($comment.list.discuss) == 0}>
<div class="boxBrown division">
<{$comment.null_notice.discuss}>
</div>
<{else}>
<div class=" Comments" id="goods-comment">
<{foreach from=$comment.list.discuss item=comlist name=discusslist}>



  <div class="division boxBrown" >
    <div >
	<div class="pinglunmessage">
    <strong><span class="author " style=" color:#9A9A9A;"><{$comlist.author}><!--<{if $comlist.levelname!=""}> [<{$comlist.levelname}>]<{/if}> --></span> <{t}>说：</strong><{/t}>
    <span class="timpstamp font10px fontcolorGray replies prepend-1"><{$comlist.time|cdate:'SDATE_STIME'}>
    
     </span>
    
    <div class="boxBlue" style="word-break:break-all; color:#666666;"><{$comlist.comment|escape:'html'}></div>
	<a class="floatRight lnk " href="<{link ctl="comment" act="reply" arg0=$comlist.comment_id}>" arg1="ask"><{t}>Reply to this comment<{/t}></a>
	</div>
    
     <div>
    <{foreach from=$comlist.items item=items}>
    <div  class="pinglunmessageh">
    <span style="color:#9A9A9A;" style="font-weight:bold;"><{$items.author}>回复：<!--<{if $items.levelname!=""}> [<{$items.levelname}>]<{/if}> --><{t}><{/t}></span>
    <span class="timpstamp font10px fontcolorGray replies prepend-1"><{$items.time|cdate:'SDATE_STIME'}></span>
    <div style="color:#E86C6C;"><{$items.comment}></div>
	
    </div>
 <{/foreach}> 
 </div>    
    
    </div>
    </div>
   

<{/foreach}>
</div>
<div class="textright"><a href="<{link ctl="comment" act="commentlist" arg0=$goods.goods_id arg1="discuss"}>"><{t}>More&gt;&gt;<{/t}></a></div>
<{/if}>

<form class="addcomment" method="post" action="<{link ctl="comment" act="toComment" arg0=$goods.goods_id arg1="discuss"}>">
  <h4><{t}>Your Points and Views<{/t}></h4>
  <div class="division">
      <table border="0" cellpadding="0" cellspacing="0" width="100%" class="forform">
          <tr>
            <th><em>*</em><{t}>Subject：<{/t}></th>
                <td><{input type="text" class="inputstyle"  required="true" size=50 name="title"}></td>
            </tr>
           <tr>
           <th><em>*</em><{t}>Your Contact：<{/t}></th>
                <td><{input type="text" class="inputstyle"  required="true" size=20 name="contact"}><span class="infotips"><{t}>(Your email address)<{/t}></span></td>
            </tr>
            <tr>
            <th><em>*</em><{t}>Comments：<{/t}></th>
              <td><{input type="textarea" class="inputstyle"  required="true" rows="5" name="comment" style="width:80%;"}></td>
            </tr>
            <{if $discussshow == "on"}>
            <tr>
            <th><em>*</em><{t}>验证码：<{/t}></th>
                <td><{input type="text" required="true" size="4" maxlength="4" name="discussverifyCode"}>&nbsp;<img src="<{link ctl="passport" act="verifyCode" arg0="discuss"}>" border="1" id="discussimgVerifyCode"/><a href="javascript:changeimg('discussimgVerifyCode','discuss')"><{t}>&nbsp;看不清楚?换个图片<{/t}></a>
                </td>
            </tr>
            <{/if}>
            <tr>
            <td></td>
              <td><input  style="padding:0; line-height:120%;" type="submit" value="Submit"></td>
            </tr>
        </table>
  </div>
</form>
</div>
</div>
<{/if}>






<{if $comment.switch.ask == 'on'}>
<div class="section pdtdetail zhixun" tab="Quires(<em><{$comment.askCount|default:'0'}></em>)">
<h2><{t}>Quires<{/t}><span><a style="color:#666666" href="<{link ctl="comment" act="commentlist" arg0=$goods.goods_id arg1="ask"}>"><{t}>（Current Quires<{/t}><span style="color:#FF0000; padding-left:5px;"><{$comment.askCount|default:'0'}></span><{t}>）<{/t}></a></span></h2>
<div class="FormWrap">
<{if count($comment.list.ask) == 0}>
<div class="boxBrown division">
<{$comment.null_notice.ask}>
</div>
<{else}>
<div class=" Comments" id="goods-comment">
<{foreach from=$comment.list.ask item=comlist name=asklist}>



  <div class="division boxBlue clearfix" >
    <div class=" floatLeft commentMain">
    <span style="color:#9A9A9A;font-weight:bold;"><{$comlist.author}>说：<!--<{if $comlist.levelname!=""}> [<{$comlist.levelname}>]<{/if}> --></span> <{t}><{/t}>
    <span class="timpstamp font10px fontcolorGray"><{$comlist.time|cdate:'SDATE_STIME'}></span>
    <div style="color:#666666;"><{$comlist.comment|escape:'html'}></div>
	<a class="floatRight lnk " href="<{link ctl="comment" act="reply" arg0=$comlist.comment_id}>" arg1="ask"><{t}>Reply to this comment<{/t}></a>
    </div>
    </div>
    <div class="commentReply prepend-1">
    <{foreach from=$comlist.items item=items}>
    <div class="division  item " style=" margin-top:0; background:none;" >
    <span style="color:#9A9A9A;font-weight:bold;"><{$items.author}>回复：<!--<{if $items.levelname!=""}> [<{$items.levelname}>]<{/if}> --><{t}><{/t}></span>
    <span class="timpstamp font10px fontcolorGray"><{$items.time|cdate:'SDATE_STIME'}></span>
    <div><{$items.comment}></div>
    </div>
 <{/foreach}> 
 </div>    
    

 
 
<{/foreach}>
</div>
<div class="textright"><a href="<{link ctl="comment" act="commentlist" arg0=$goods.goods_id arg1="ask"}>"><{t}>More&gt;&gt;<{/t}></a></div>
<{/if}>

<form class="addcomment" method="post" action="<{link ctl="comment" act="toComment" arg0=$goods.goods_id arg1="ask"}>">
  <h4><{t}>Your Quires<{/t}></h4>
  <div class="division">
      <table border="0" width="100%" cellpadding="0" cellspacing="0" class="forform">
          <tr>
            <th><em>*</em><{t}>Subject：<{/t}></th>
                <td><{input type="text" class="inputstyle"  required="true" size=50 name="title"}></td>
            </tr>
           <tr>
           <th><em>*</em><{t}>Your Contact：<{/t}></th>
                <td><{input type="text" class="inputstyle"  required="true" size=20 name="contact"}><span class="infotips"><{t}>(Your email address)<{/t}></span></td>
            </tr>
            <tr>
            <th><em>*</em><{t}>Quires：<{/t}></th>
              <td><{input type="textarea" class="inputstyle"  required="true" rows="5" name="comment" style="width:80%;"}></td>
            </tr>
            <tr>
            <{if $askshow == "on"}>
            <th><em>*</em><{t}>验证码：<{/t}></th>
              <td><{input type="text" required="true" size="4" maxlength="4" name="askverifyCode"}>&nbsp;<img src="<{link ctl="passport" act="verifyCode" arg0="ask"}>" border="1" id="askimgVerifyCode"/><a href="javascript:changeimg('askimgVerifyCode','ask')"><{t}>&nbsp;看不清楚?换个图片<{/t}></a></td>
            </tr>
            <{/if}>
            <tr>
            <td></td>
              <td><input name="submit" type="submit"  style="padding:0; line-height:120%;" value="Submit" /></td>
            </tr>
        </table>
  </div>
</form>
</div>
</div>
<{/if}>



<{if count($gift)>0}>
<div class="section pdtdetail" tab="赠品">
<h2><{t}>赠品<{/t}></h2>
<div class="body" id="goods-gift">
  <div class="GoodsSearchWrap">
    <{foreach from=$gift item=gift key=key}>
      <div class="items-list" product="<{$gift.gift_id}>">
      <div class="goodpic">
      <{input type="checkbox" name="g[]" value=$gift.goods_id }>
      <a href="<{link ctl="product" act="index" arg0=$gift.goods_id}>" title="<{$gift.name}>" style='<{if $env.thumbnail_pic_width !=0 && $env.thumbnail_pic_width !=0}> width:<{$env.thumbnail_pic_height}>px;height:<{$env.thumbnail_pic_height}>px;<{/if}>
     overflow:hidden;text-align:center;vertical-align: middle;margin:0px auto; line-height:<{$env.small_pic_height}>px;'>
        <img src="<{$goods.image_default|gimage:'thumbnail'}>" alt="<{$gift.name}>"/></a></div>
      <div class="goodinfo">
        <h6><a href="<{link ctl="gift" act="index" arg0=$gift.gift_id}>" title="<{$gift.name}>"><{$gift.name}></a></h6>
        <ul>
        <li class="intro"><{$gift.intro}></li>
        <li><{$gift.describe}></li>
        </ul>
      </div>
      <div class="clear"></div>
      </div>
      <{/foreach}>
  </div>
</div>
</div>
<{/if}>

<{if count($coupon)>0}>
<div class="section pdtdetail" tab="可得优惠券">
<h2><{t}>可得优惠券<{/t}></h2>
<div class="body" id="goods-coupon">
  <ul style="padding:5px 20px;">
  <{foreach from=$coupon item=coupon key=key}>
    <li><{$coupon.cpns_name}></li>
  <{/foreach}>
  </ul>
</div>
</div>
<{/if}>


</div>
</div>


<script language="javascript">
window.addEvent('domready', function(){


/*Tab的处理*/
try{
var viewTabsContainer=$E('#goods-viewer .goods-detail-tab');
var viewTabs=[];
var viewSections=$$('#goods-viewer .section');

viewSections.each(function(se){
  var t=new Element('div',{'class':'goodsDetailTab'}).set('html','<span>'+se.get('tab')+'</span>');
  viewTabs.push(t);
  
});

viewTabsContainer.adopt(viewTabs);

new ItemAgg(viewTabs,viewSections,{activeName:'active',
                                     onActive:function(tab,item){
                                                  var anotherItems=$$($A(this.items).remove(item));
                                                  
                                                  if(tab.getElement('span').get('text')=='Package'){
                                                     anotherItems.show();
                                                  }else{
                                                     anotherItems.hide();
                                                  }
                                   }});
}catch(e){}
                                    
});

 var buycoutText=$E('#goods-viewer .buyinfo input[type=text]').addEvent('keydown',function(e){
             if($A(keyCodeFix).include(e.code).length>25){
               e.stop();
              }
         });
    var getStore=function(){ 

    return $E('#goods-viewer .buyinfo .store').get('text').toInt()

    };

         buycoutText.addEvent('keyup',function(e){
           
            if(getStore()<this.value)this.value=getStore();
            if(!this.value||this.value.toInt()<1)this.value=1;
         });
         /*购买数量调节*/
         $$('#goods-viewer .buyinfo .numadjust').addEvent('click',function(e){
              var countText=$E('#goods-viewer .buyinfo input[name^=goods[num]');
              if(this.hasClass('increase')){
                 countText.set('value',(countText.value.toInt()+1).limit(1,getStore()));
              }else{
                 countText.set('value',(countText.value.toInt()-1).limit(1,getStore()));
              }
              this.blur();
         });
         
         $$('#goods-viewer .buyinfo .numadjust').addEvents({
             'mousedown':function(){
                this.addClass('active');
             },
             'mouseup':function(){
               this.removeClass('active');
             }
         });



/*
执行图片的等比缩放
window.addEvent('load',function(){
         var Imgs_1=$$('#goods-rels .goodpic img');
        var Imgs_2=$$('#goods-viewer .goods-detail-pic-thumbnail img');
         var Imgs_3=$$('#goods-viewer .GoodsPackageWrap .goodpic img');
        try{
         fixProductImageSize($$(Imgs_1,Imgs_3));
         }catch(e){}
    });
*/




/*设置浏览过的商品*/
window.withUStatus(function(uStatus){
  uStatus.get('history',function(history){
  history=JSON.decode(history);
  if(!history||$type(history)!=='array')history=[];
   if(history.length==40){history.pop()};
   var newhis={'goodsId':<{$goods.goods_id}>,
               'goodsName':'<{$goods.name|replace:"'":"\'"}>',
               'goodsImg':'<{$images.gimages[$goods.image_default].small|gimage:'small'}>'
              };
   if(history.filter(function(i){return i['goodsId']==newhis['goodsId']}).length<1)
   history.include(newhis);
   uStatus.set('history',history);
  
  });
});

/*验证码刷新*/
function changeimg(id,type){
    $(id).set('src','<{link ctl="passport" act="verifyCode" arg0="'+type+'"}>#'+$time());
}

</script>

<{if $goods.FlatSpec || $goods.SelSpec }>

<script>
      /*=规格选择联动=
      *(c) shopex.cn
      *@author litie@shopex.cn
      * 2009-2
      */

 void function(){
 
   
          String.implement({
              toFormElements:function(){
                    if(!this.contains('=')&&!this.contains('&'))return new Element('input',{type:'hidden'});
                    var elements=[];
                    var queryStringHash=this.split('&');
                    $A(queryStringHash).each(function(item){
                        if(item.contains('=')){
                            item=$A(item.split('='));
                            elements.push(new Element('input',{type:'hidden',name:item[0],value:item[1]}));
                        }else{
                          elements.push(new Element('input',{type:'hidden',name:item}));
                        }
                    });
                    return new Elements(elements);
                    }
          });
          
          
          
          var buyBtn=$empty;
          var notifyBtn=$empty;
          var setbuyBtnTip=$empty;
          var popAloneSpec=$empty;
         
         window.addEvent('domready',function(){

              buyBtn=$E('#goods-viewer .btn-buy').store('tip:text','');            
              notifyBtn=$E('#goods-viewer .btn-notify').store('tip:text','Sorry, there is no stock, you can subscribe Arrival Notice');
              
             new Tips(buyBtn,{showDelay:0,hideDelay:0,className:'cantbuy',
                     onShow:function(tip){
                        if(!this.textElement||!$E('.tip-text',tip)||!$E('.tip-text',tip).getText()){
                            buyBtn.setStyle('cursor','pointer');
                            return tip.setStyle('visibility','hidden');
                        }else{
                            buyBtn.setStyle('cursor','not-allowed');
                        }
                        tip.setStyle('visibility','visible');
                     }
              });
              new Tips(notifyBtn,{className:'cantbuy',showDelay:0,hideDelay:0});
              
               buyBtn.addEvent('click',function(e){
                   e.stop();
                   this.blur();      
                   if(this.retrieve('tip:text'))return false;
                   
                   this.form.submit();
                   
               });
               notifyBtn.addEvent('click',function(e){
                      e.stop();
                      this.blur();
                      new Element('form',{method:'post','action':this.form.get('gnotify')}).adopt(
                         this.form.toQueryString().toFormElements()
                      ).inject(document.body).submit();
                });    
                
               setbuyBtnTip=function(){ 
                    var spec_item_nocheck=[];
                    $ES('#goods-spec .spec-item em').each(function(em){
                        
                        if(!em.hasClass('check'))spec_item_nocheck.include(em.getText());
                      
                    });                
                     if(spec_item_nocheck.length>0){
                        buyBtn.store('tip:text','Please Select：'+spec_item_nocheck.join(','));
                     }else{
                       buyBtn.store('tip:text','');
                     }
                     return arguments.callee;
                 }();
                 
                 
             popAloneSpec=function(){
            
                $$('#goods-spec table.spec-item').filter(function(si){
                          
                          if(si.hasClass('check'))return false;
                          
                          var specs=si.getElements('a[specid]');
                          if(specs.length>1)return false;
                         
                          return !specs[0].hasClass('selected')&&!specs[0].hasClass('lock');
                
                }).each(function(sitem){
                     sitem.getElement('a[specid]').fireEvent('click');
                  }
               );
              
               return arguments.callee;
          
             }();    

         });            

     
          var getSpecText=function(el){
             if($E('img',el))
             return $E('img',el).alt||$E('img',el).title;
             return $E('span',el).get('text');
          };
          
          var specItems=$ES('#goods-spec .spec-item em');
          var referencePoint={
                  bn:$('goodsBn'),
                  marketPrice:$E('#goods-viewer .mktprice1'),
                  price:$E('#goods-viewer .price1'),
                  discount:$E('#goods-viewer .discount'),
                  store:$E('#goods-viewer .buyinfo .store'),
                  specTip:$E('#goods-spec .spec-tip'),
                  update:function(v,html){
                     return referencePoint[v]?referencePoint[v].setHTML(html):false;
                  }
          };
          var RPSV=$H(referencePoint).getValues();
          RPSV.each(function(el){
               if(el&&$type(el)=='element')
               el.retrieve('defaultInnerHTML',el.get('html'));
          });
          
          var referencePointDef=function(){
                RPSV.each(function(el){
                   if(el&&$type(el)=='element')
                   el.setHTML(el.retrieve('defaultInnerHTML'));
               });
               if($E('#goods-viewer .mprice'))$E('#goods-viewer .mprice').hide();
               updatepic();
               buyBtn.show();
               notifyBtn.hide();
               
          };
          
          
          
          
          var PRODUCT_HASH=new Hash(<{$goods.product2spec}>);
          var PRODUCT_SPECV_ARR=[];
              PRODUCT_HASH.each(function(v){
                   PRODUCT_SPECV_ARR.push(v['spec_private_value_id']);
              });
          var SPEC_HASH=new Hash(<{$goods.spec2product}>);
          var updatepicRequest=new Request.HTML({url:'<{link ctl=product act=goodspics}>',
                                                 update:$E('#goods-viewer .goodspic'),
                                                 autoCancel:true,
                                                 onRequest:function(){
                                                  }
                                                });
          /*相册联动*/
          var updatepic=function(vids){
                if(!vids)vids='';
               var pud=$E('#goods-viewer .goodspic').retrieve('picsupdatedelay');
               var put=$E('#goods-viewer .goodspic').retrieve('picsupdatetemp','');
               $clear(pud);
               if(put==vids)return;
               $E('#goods-viewer .goodspic').store('picsupdatedelay',
                  (function(){
                  updatepicRequest.post({gimages:vids,goodsId:$E('#goods-viewer input[name^=goods[goods_id]').get('value')});
                  $E('#goods-viewer .goodspic').store('picsupdatetemp',vids);
                  }).delay(800)
               );
          };
          
          
          /*其他联动*/
          
          var updateReference=function(specSelected,specvidarr){
                
                var fix=(specvidarr.length==specItems.length);
                setbuyBtnTip();
                var productIntersection=[];
             
                /*当前已选择规格的商品交集*/
                 var specTip=[];
                 var picsId=[];
                if(specSelected){
                    specSelected.each(function(s){
                         productIntersection.combine(SPEC_HASH[s.get('specvid')]['product_id']);
                         
                         specTip.include("<font size=2>\""+getSpecText(s)+"\"</font>");
                         picsId.combine(SPEC_HASH[s.get('specvid')]['images']);
                    });
                }
                           
                if(!productIntersection||!productIntersection.length)return referencePointDef();
                
               
                var price=[];
                productIntersection.each(function(pid){
                    var product=PRODUCT_HASH[pid];
                    /*if(storeCount.toInt()>9999){
                      storeCount='9999+';
                    }else{
                      storeCount=storeCount.toInt()+product['store'].toInt();
                    }*/
                    
                    price.include(product['price']).clean();
                    
                });
                
                /*相册联动*/
                updatepic(picsId.clean().join(','));
                
                /*库存联动 
                referencePoint.update('store',storeCount.toInt()>9999?'9999+':storeCount);*/
               
                /*价格联动*/
                if(price.length>1){
                      price.sort(function(p1,p2){
                         p1=p1.toInt();
                         p2=p2.toInt();
                         if(p1>p2)return 1;
                         if(p1==p2)return 0; 
                         return -1;
                      });
                      referencePoint.update('price',priceControl.format(price[0])+'-'+priceControl.format(price[price.length-1]));
                }else{
                     referencePoint.update('price',priceControl.format(price[0]));
                }
                
                /*规格选择提示联动*/
                referencePoint.update('specTip','<em style="color:#4A4A4A;">Your Selection：</em><span>'+specTip.join("、")+'</span>');
                
                
                var product_hiddenInput=$E('#goods-spec input[name^=goods[product_id]').set('disabled',!fix);
                var mprice=$E('#goods-viewer .mprice');
                
                
               /*定位到货品*/
                if(fix){
                     var fixProductID=null;
                     PRODUCT_HASH.each(function(v,k){
                          if($A(v['spec_private_value_id']).combine(specvidarr).length==specvidarr.length){
                             fixProductID=k;
                          }
                     });
                    
                     if(fixProductID){
                     var fixProduct=PRODUCT_HASH[fixProductID];
                     
                     referencePoint.update('bn',fixProduct['bn']);
                     referencePoint.update('store',fixProduct['store']||0);
                     var _price=referencePoint.update('price',priceControl.format(fixProduct['price']));
                     product_hiddenInput.set('value',fixProductID);
                    
                     /*库存联动*/
                     if(referencePoint['store']&&(referencePoint['store'].getText().toInt()<1)){
                     
                           buyBtn.hide();
                           notifyBtn.show();
                           return;                       
                      }
                    
                     if(buynum=$E('#goods-viewer .buyinfo input[type=text]')){
                        buynum.fireEvent('keyup');
                     }                    
                     

                     
                      
                      /*优惠联动*/
                     
                      if(referencePoint['discount']&&referencePoint['marketPrice']){
                          var dcType={
                                     T1:'节省',
                                     T2:'优惠',
                                     T3:'折'
                                    };
                          var _discount=referencePoint['discount'];
                          var _discountValue=_discount.get('text');
                          var _marketPrice=referencePoint['marketPrice'];
                          var fdt=priceControl._format.sign;
                          
                          var _priceValue = _price.get('text').split(fdt);
                              _priceValue = (_priceValue.length>1?_priceValue[1]:_priceValue[0]).toInt();
                              
                          var _priceMarketValue = _marketPrice.get('text').split(fdt);
                         
                         _priceMarketValue = (_priceMarketValue.length>1?_priceMarketValue[1]:_priceMarketValue[0]).toInt();

                          var _priceDiff=_priceMarketValue-_priceValue;
                          
                          if(_discountValue.test(dcType.T2,'i')){
                            referencePoint.update('discount','优惠：'+(_priceDiff/_priceMarketValue*100).toInt()+'%');
                          }else if(_discountValue.test(dcType.T3,'i')){
                            referencePoint.update('discount',((1 - _priceDiff/_priceMarketValue)*10).toInt().limit(1,9)+'折');
                          }else{
                            referencePoint.update('discount','节省：'+priceControl.format(_priceDiff));
                          }

                      }
                      
                      
                      /*会员价联动*/
                      if(mprice){
                          mprice.getElements('.mlvprice').each(function(lvp){
                              lvp.set('text',priceControl.format(fixProduct['mprice'][lvp.get('mlv')]));
                          });
                          mprice.show();
                      }
                   }
                   
                }else{
                   if(mprice)
                   mprice.hide();
                }
                   
                   buyBtn.show();
                   notifyBtn.hide();
                   
                   
                
          };
          
          var specSelections=$$('#goods-spec .spec-item a[specvid]');
              specSelections.addEvent('click',function(e){
                     e?e.stop():e;
                     this.blur();
                     var specid=this.get('specid');
                     var specvid=this.get('specvid');
                     var prt=this.getParent('li.content')||this.getParent('ul');
                     
                     if(this.hasClass('lock'))return;
                     if(this.hasClass('selected')){
                           this.removeClass('selected');
                           if(prt.hasClass('content')){
                                 var handle=prt.retrieve('handle');
                                 $E('span',handle).set('text','Please Select').removeClass('select');
                                 handle.removeClass('curr');
                                 prt.removeClass('content-curr');
                           }
                           specSelectedCall(0,specid,this);
                           return;
                     }
                     
                      var tempsel=prt.retrieve('ts',this);
                      if(tempsel!=this){tempsel.removeClass('selected')}
                      prt.store('ts',this.addClass('selected'));
                      
                          if(prt.hasClass('content')){
                                 var handle=prt.retrieve('handle');
                                 $E('span',handle).set('text',getSpecText(this)).addClass('select');
                                 handle.removeClass('curr');
                                 prt.removeClass('content-curr');
                           }
                      
                      
                      specSelectedCall(specvid,specid,this);
                      popAloneSpec();
                  
                     
              
              });
              
        
          
        void function(){
           /*下拉方式的规格选择*/     
          var specHandles=$$('#goods-spec .spec-item .handle');
          var specContents=$$('#goods-spec .spec-item .content');

          var tempSlipIndex=0;
          var tempCurrentIndex=-1; 
          
              specHandles.each(function(handle,index){
                 var content=specContents[index];
                 var contentPadding=content.getPadding();
                 
                     handle.addEvent('click',function(e){
                          if(tempCurrentIndex>=0&&tempCurrentIndex!=index){
                              specHandles[tempCurrentIndex].removeClass('curr');
                              specContents[tempCurrentIndex].removeClass('content-curr');
                           }
                           tempCurrentIndex=index;
                           this.toggleClass('curr');
                           content.toggleClass('content-curr').retrieve('handle',this);
                           content.setStyles({'top':this.getCis().bottom-4,
                                              'left':specHandles[0].getPosition().x-3,
                                              'width':this.getParent('.goods-spec').getSize().x-(contentPadding.x+contentPadding.y+14)
                           });
                           
                     });
                 
                 });
                 
             }();
          /*规格点击时call此函数*/
          var specSelectedCall=function(specvid,specid,spec){
               var unclick=!specvid;
               var specSelected=$$('#goods-spec .spec-item a.selected');
              
              
                var selectedSpecvids=[];
                specSelected.each(function(s){
                        var _specvid=s.get('specvid');
                        selectedSpecvids.include(_specvid);
                    });
            
             
                
                /*设置 spec-item 状态*/
                var em=(spec.getParent('li.content')&&spec.getParent('li.content').retrieve('handle')
                       ||spec.getParent('.spec-item')).getElement('em');
                       
                em[spec.hasClass('selected')?'addClass':'removeClass']('check');
                
    
                /*隐藏|显示无交集规格值*/
                
                var usefulSpecvArr=[];
                if(selectedSpecvids.length){
                    selectedSpecvids.each(function(v){
                           usefulSpecvArr=(usefulSpecvArr.length?usefulSpecvArr:PRODUCT_SPECV_ARR).filter(function(arr){
                               return arr.indexOf(v)>-1;
                           });
                           
                    });
                }else{
                   usefulSpecvArr=PRODUCT_SPECV_ARR;
                }
                usefulSpecvArr=usefulSpecvArr.flatten();
              
               specSelections.each(function(s){
                    if(usefulSpecvArr.indexOf(s.get('specvid'))>-1){
                      return s.removeClass('lock')
                    }
                    s.addClass('lock');
               });
               
               if(selectedSpecvids.length==1){
                  var aspec=$E('#goods-spec a[specvid='+selectedSpecvids[0]+']');
                  (aspec.getParent('li.content')||aspec.getParent('ul')).getElements('a[specvid]').removeClass('lock');
               }
              
                
               
               updateReference(specSelected,selectedSpecvids);
               
 
            };
            
    
          
          
      }();
 </script>
 <{elseif $goods.store==='0'}>
     <script>
     /*无规格商品到货通知 show*/
      window.addEvent('domready',function(){
              var buyBtn=$E('#goods-viewer .btn-buy'); 
            var notifyBtn=$E('#goods-viewer .btn-notify').store('tip:text','您当前要购买的商品暂时缺货,点击进入缺货登记页.');
            new Tips(notifyBtn,{className:'cantbuy',showDelay:0,hideDelay:0});
            
            buyBtn.hide();
            notifyBtn.show();
            
            notifyBtn.addEvent('click',function(e){
                      e.stop();
                      this.blur();
                      this.form.action=this.form.get('gnotify');
                      
                      this.form.submit();
                });  
      
      }); 
     </script>
     
 <{/if}>
 
 <{if $goods.adjunct && count($goods.adjunct)>0}>
  <script>
     /*配件JS*/
    void function(){

     var updateAdjunctPrice=function(){
           var adjunctPrice=0;
 
           var selected=$$('#goods-adjunct tr').filter(function(tr,index){
           
                       return tr.getElement('input[type=checkbox]').checked;
           
           });
           selected.each(function(s,i){
               adjunctPrice+=s.get('price').toFloat()*s.getElement('input[type=hidden]').value.toFloat();           
           });
           var price=isNaN(adjunctPrice)?0:adjunctPrice;
           $E('#goods-adjunct .price').set('text',priceControl.format(price)); 
           
          
      };
      
      
   
        var adjunctCheckbox=$ES('#goods-adjunct input[type=checkbox]');
        var adjunctText=$ES('#goods-adjunct input[type=text]');
        

        adjunctCheckbox.addEvent('click',function(e){
              var  prt=this.getParent('tr');
              var  min_num=prt.getParent('tbody').get('min_num').toInt();
              if(isNaN(min_num)||min_num<1)min_num=1;
              
              
              var _hidden=prt.getElement('input[type=hidden]').set('disabled',!this.checked);
              
              this.checked?prt.setStyle('background','#e9e9e9'):prt.setStyle('background','#fff');     
              
              var _text=prt.getElement('input[type=text]');
              
              if(!_text.value||_text.value<min_num){
                _hidden.value=_text.value=min_num;
              }else{
                _hidden.value=_text.value;
              }
              updateAdjunctPrice();
              
        });
        
        adjunctText.addEvent('keydown',function(e){
          if($A(keyCodeFix).include(e.code).length>25)
           e.stop();
        });
        adjunctText.addEvent('keyup',function(e){
              var  prt=this.getParent('tr');
              var min_num=prt.getParent('tbody').get('min_num').toInt();
              var max_num=prt.getParent('tbody').get('max_num').toInt();
              var _hidden=prt.getElement('input[type=hidden]');
              if(isNaN(min_num)||min_num<0){
                 min_num=0;
              };
              if(isNaN(max_num)||max_num<0){
                 max_num=Number.MAX_VALUE;
              };
              if(this.value){
                _hidden.value=this.value=this.value.toInt().limit(min_num,max_num);
              }
              updateAdjunctPrice();   
        });
        
        
    
    }();
  
  </script>

<{/if}>
