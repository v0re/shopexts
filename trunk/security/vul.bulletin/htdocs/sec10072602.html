<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<META NAME="generator" CONTENT="http://txt2tags.sf.net">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" HREF="http://shopexts.googlecode.com/files/vul.css">
<TITLE>招行帐号支付插件验签方法无效</TITLE>
</HEAD>
<BODY>

<DIV CLASS="header" ID="header">
<H1>招行帐号支付插件验签方法无效</H1>
<H2>last modify 2010-08-16 10:49:00 Monday</H2>
</DIV>

<DIV CLASS="body" ID="body">
<H4>添加时间</H4>
<P>
2010-06-07
</P>
<H4>系统编号</H4>
<P>
SEC-10060701
</P>
<H4>影响版本</H4>
<P>
ShopEx485 &gt;= 38669
</P>
<H4>漏洞危害</H4>
<P>
可以直接修改招行支付接口付款的订单状态
</P>
<H4>漏洞原理</H4>
<P>
招行支付接口是把数据合法性验证的工作交给开发者自己实现的，我们对提交的数据签名算法有问题，callback函数中:
</P>
<P>
'''
$MerchantPara = $in["MerchantPara"];
</P>
<P>
$md5src = $merId.$keyPass.$BranchID.$BillNo.$Amount.$this-&gt;callbackUrl;
</P>
<P>
$md5sign = strtoupper(md5($md5src));
</P>
<P>
$money = $Amount;
</P>
<P>
if($md5sign == $MerchantPara ){
'''
</P>
<P>
$MerchantPara取的不是招行返回的Signature变量，而是我们提交时候的MerchantPara，恶意用户是可以根据提交的数据推导出这个验证支付穿的。
</P>
<H4>检测方法</H4>
<P>
无
</P>
<H4>解决方案</H4>
<P>
不采用无验证的提交方式，使用招行另外一种需要对数据进行签名的方法
</P>
<H4>信息来源</H4>
<P>
客户反馈
</P>
</DIV>

<!-- html code generated by txt2tags 2.5 (http://txt2tags.sf.net) -->
<!-- cmdline: txt2tags -\-target=html -\-infile=t2t/sec10060701.t2t -\-outfile=htdocs/sec10072602.html -->
</BODY></HTML>
