<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<META NAME="generator" CONTENT="http://txt2tags.sf.net">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<LINK REL="stylesheet" TYPE="text/css" HREF="http://shopexts.googlecode.com/files/vul.css">
<TITLE>ShopEx助理api接口过滤不严</TITLE>
</HEAD>
<BODY>

<DIV CLASS="header" ID="header">
<H1>ShopEx助理api接口过滤不严</H1>
<H2>last modify 2010-11-18 16:53:30 Thursday</H2>
</DIV>

<DIV CLASS="body" ID="body">
<H4>添加时间</H4>
<P>
2010-09-19
</P>
<H4>系统编号</H4>
<P>
SEC10091901
</P>
<H4>影响版本</H4>
<P>
ShopEx48系列 &lt;= 45144 
</P>
<H4>漏洞危害</H4>
<P>
不需要后台帐号就可以查到订单列表内容。
</P>
<H4>漏洞原理</H4>
<P>
在助理api接口/core/api/include/api_link.php
</P>
<PRE>

             'search_order_list'=&gt;array(
                  '1.0'=&gt;array('ctl'=&gt;'api/order/api_1_0_order','act'=&gt;'search_order_list','columns'=&gt;'*','n_varify'=&gt;'true'
                  )
             ),


</PRE>
<P>
中是否跳过验证'n_varify'设置为true,导致不需要验证也可以获取用户订单列表
</P>
<H4>检测方法</H4>
<P>
方法1
</P>
<PRE>

curl -d "act=search_order_list&amp;api_version=1.0&amp;counts=50&amp;last_modify_st_time=0&amp;last_modify_en_time=300000000000&amp;pages=0&amp;password=gkk522004&amp;status=active&amp;tolken=&amp;username=admin&amp;ac=C30F2929C886AA28CF5F0276729374C5" http://www.xxx.com/api.php

</PRE>
<P></P>
<P>
<A HREF="http://www.xxx.com">http://www.xxx.com</A>换成用户的实际地址！
</P>
<P>
方法2：
</P>
<P>
下载这个程序
</P>
<P>
<A HREF="http://shopexts.googlecode.com/files/shopex.api.ordersearch.vul.rar">http://shopexts.googlecode.com/files/shopex.api.ordersearch.vul.rar</A>
</P>
<P>
 输入网店地址/api.php，勾选“下载全部订单”，点击“开始导出csv”如果下载数据说明系统有漏洞。
</P>
<H4>解决方案</H4>
<P>
1）补丁下载地址
</P>
<P>
<A HREF="http://downtcom.shopex.cn/update/sec10091901.zip">http://downtcom.shopex.cn/update/sec10091901.zip</A>
</P>
<P>
2）如果要自行修复，请将/core/api/include/api_link.php
</P>
<PRE>

             'search_order_list'=&gt;array(
                  '1.0'=&gt;array('ctl'=&gt;'api/order/api_1_0_order','act'=&gt;'search_order_list','columns'=&gt;'*','n_varify'=&gt;'true'
                  )
             ),


</PRE>
<P></P>
<P>
去掉“'n_varify'=&gt;'true'”，改成
</P>
<PRE>

             'search_order_list'=&gt;array(
                  '1.0'=&gt;array('ctl'=&gt;'api/order/api_1_0_order','act'=&gt;'search_order_list','columns'=&gt;'*'
                  )
             ),


</PRE>
<P></P>
<H4>信息来源</H4>
<P>
客户反馈
</P>
</DIV>

<!-- html code generated by txt2tags 2.5 (http://txt2tags.sf.net) -->
<!-- cmdline: txt2tags -\-target=html -\-infile=t2t/10091901.t2t -\-outfile=htdocs/10091901.html -->
</BODY></HTML>
