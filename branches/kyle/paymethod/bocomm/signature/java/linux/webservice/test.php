<?php

//$signedmessage = sign('bocomm');
//var_export($signedmessage);

$ret = array (
  'notifyMsg' => '301310063009501|12586249100616|1.00|CNY|20100206| |20091119|180206|09114146|1|00000000002.0000|0| | |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',
);

$returnmsg=explode("|",$ret['notifyMsg']);

$signMsg = $returnmsg[14];
$srcMsg="";
for($i=0;$i<14;$i++)
{
	$srcMsg.=$returnmsg[$i]."|";
}

$ret = verify($srcMsg, $signMsg);

var_export($ret);

function sign($message){
	$fp = fsockopen("127.0.0.1", 9555, $errno, $errstr, 30);
	if (!$fp) {
		echo "$errstr ($errno)<br />\n";
	} else {
		$out = "sign{$message}\r\n";
		fwrite($fp, $out);
		while (!feof($fp)) {
			$ret .= fgets($fp, 128);
		}
		fclose($fp);

		return $ret;
	}
}

function verify($src, $signed){
	$fp = fsockopen("127.0.0.1", 9555, $errno, $errstr, 30);
	if (!$fp) {
		echo "$errstr ($errno)<br />\n";
	} else {
		$out = "veri%{$src}%{$signed}\r\n";
		fwrite($fp, $out);
		while (!feof($fp)) {
			$ret .= fgets($fp, 128);
		}
		fclose($fp);

		return $ret;
	}
}

?>